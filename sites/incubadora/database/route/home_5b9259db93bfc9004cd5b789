module.exports = app => {

	var currentLocation = {
		text: "Mar del Plata, Argentina",
		coords: [-38.0034174,-57.6197688],
		zoom: 8
	};
	

	app.srv.misitiobaApi.configure('incuba');
	
	var JsonDB = require('node-json-db');
	var db = new JsonDB("jsonDatabase", true, true);
	const bodyParser = app.require('body-parser');
	const parseJson = bodyParser.json({
		limit: '50mb'
	});
	
	
	app.post('/jsonDb',parseJson, (req, res) => {
		var r = {
			result: null,
			err: null
		};
		try {
			r.result = db[req.body.method].apply(db, req.body.params);
		} catch (err) {
			console.error('ERROR jsonDb', err.stack);
			r.err = err.stack;
		}
		res.json(r);
	});


	

	
	//HOME
	app.get('/', async (req, res) => {
		res.sendView('home',{
			lastNews: await app.fn.getLastNews(),
			currentLocation
		})
	})
	
	app.get('/donde-estamos', async (req, res) => {
		var address = db.getData('/location');
		res.sendView('location',{
			address,
			currentLocation
		})
	})
	
	app.get('/politica-de-privacidad', async (req, res) => {
		res.sendView('privacy-terms',{})
	})
	
	//RED DE VOLUNTARIOS
	app.get('/red-voluntarios', getVoluntariado);
	
	async function getVoluntariado(req, res){
		res.sendView('voluntarios',{
			metaTitle:"Red de voluntarios en Latinoamerica - Proyectos sociales y ambientales"
		});
	}
	
	
		
	app.get('/como-podemos-ayudar', async (req, res) => {
		res.sendView('como-podemos-ayudar',{
			//lastNews: await app.fn.getLastNews()
		})
	})
	
	app.get('/recursos', async (req, res) => {
		res.sendView('resources',{
			metaTitle:"Recursos para Emprendedores en Latinoamerica - Proyectos sociales y ambientales"
		});
	});
	
	
}